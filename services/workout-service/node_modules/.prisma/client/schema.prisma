generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== ENUMS =====

enum Gender {
  MALE
  FEMALE
}

enum BodyType {
  ECTO
  ENDO
  // add MESO later if needed
}

enum WorkoutType {
  A
  B
  FBW
  UPPER
  LOWER
  GLUTES
  HIIT
  PUSH
  PULL
  LEGS
}

enum MuscleGroup {
  CHEST
  BACK
  SHOULDERS
  LEGS
  GLUTES
  ARMS
  BICEPS
  TRICEPS
  ABS
  FULL_BODY
}

// ===== CORE MODELS =====

// Exercise master data; can be system-defined or coach-defined
model Exercise {
  id          String      @id @default(cuid())
  name        String
  description String? // how to perform the exercise
  notes       String? // general tips / warnings
  muscleGroup MuscleGroup

  gender   Gender? // null = for all
  bodyType BodyType? // null = for all

  // Which workout types this exercise is especially suitable for (A/B/FBW/etc.)
  workoutTypes WorkoutType[]

  equipment  String? // Barbell, Dumbbell, Machine, Bodyweight...
  difficulty String? // optional text, e.g. "easy", "medium", "hard"

  // null => system exercise; otherwise, created by a specific coach
  createdByCoachId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workoutExercises WorkoutExercise[]
}

// Template that defines WHICH MUSCLES should be included in a workout
// For example: male, level 2, ecto, type A => [CHEST, BACK, SHOULDERS, BICEPS, TRICEPS]
model WorkoutTemplate {
  id          String      @id @default(cuid())
  gender      Gender
  level       Int
  bodyType    BodyType?
  workoutType WorkoutType

  muscleGroups MuscleGroup[]

  name  String?
  notes String?
}

// Concrete workout program for a specific client
model WorkoutProgram {
  id       String @id @default(cuid())
  clientId String
  coachId  String
  name     String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  exercises WorkoutExercise[]
}

// Exercise instance inside a client's program
model WorkoutExercise {
  id String @id @default(cuid())

  programId  String
  exerciseId String

  sets   Int
  reps   String // "8-12"
  weight Float?
  rest   Int? // seconds
  order  Int
  notes  String? // coach notes specific to this client

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  program  WorkoutProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
  exercise Exercise       @relation(fields: [exerciseId], references: [id])
}

// Optional: logging model compatible with the shared logger used in menu-service
model LogEntry {
  id        String  @id @default(cuid())
  level     String
  method    String
  path      String
  status    Int
  userId    String?
  ip        String?
  userAgent String?
  message   String
  meta      Json?

  createdAt DateTime @default(now())
}
